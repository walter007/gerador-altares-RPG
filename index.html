<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gerador de MissÃµes - Altaris</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <script type="module">
    // Importe tudo o que vocÃª precisa diretamente
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCATBfMk70mJuISZRUD698VZjMv4qTVWew",
        authDomain: "altares-rpg.firebaseapp.com",
        projectId: "altares-rpg",
        storageBucket: "altares-rpg.firebasestorage.app",
        messagingSenderId: "904700894694",
        appId: "1:904700894694:web:26f3a7773f61fe91ef8a27"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Mantenha apenas a conexÃ£o com o Firestore no objeto global
    // Use window.firebaseModules para agrupar tudo
    window.firebaseModules = {
        db: db,
        doc: doc,
        getDoc: getDoc,
        setDoc: setDoc
    };
</script>

<link rel="stylesheet" href="modalCss.css">

</head>
<body class="bg-light pt-4" onload="iniciarApp()">

<div class="container">

  <div id="menu" class="rpg-menu">
  <h1 class="rpg-title">Gerador Altaris</h1>

  <div class="rpg-menu-grid">

    <button class="rpg-menu-card" onclick="abrirSecao('sec-mapa')">
      <div class="rpg-icon">ğŸ“œ</div>
      <h3>Mapa</h3>
      <p>Mapa do mundo.</p>
    </button>

    <button class="rpg-menu-card" onclick="abrirSecao('sec-diario')">
      <div class="rpg-icon">ğŸ“˜</div>
      <h3>DiÃ¡rio</h3>
      <p>AnotaÃ§Ãµes das cenas da campanha.</p>
    </button>

    <button class="rpg-menu-card" onclick="abrirSecao('pjSection')">
      <div class="rpg-icon">ğŸ‘¤</div>
      <h3>PJ</h3>
      <p>Personagens Jogaveis.</p>
    </button>

    <button class="rpg-menu-card" onclick="abrirSecao('sec-encontros')">
      <div class="rpg-icon">ğŸ‘¤</div>
      <h3>NPC</h3>
      <p>Personagens nÃ£o Jogaveis.</p>
    </button>

    <button class="rpg-menu-card" onclick="abrirSecao('sec-tabelas-oraculo')">
      <div class="rpg-icon">âš™ï¸</div>
      <h3>Tabela Oraculo</h3>
      <p>Tabelas usadas para geraÃ§Ã£o de evento do oraculo.</p>
    </button>

    <button class="rpg-menu-card" onclick="abrirSecao('sec-campanhas')">
      <div class="rpg-icon">ğŸ“</div>
      <h3>Criar / Carregar Campanha</h3>
      <p>Gerenciamento das Campanhas</p>
    </button>

    <button class="rpg-menu-card" onclick="regenerarMapa()">
      <div class="rpg-icon">ğŸ“</div>
      <h3>Refazer Mapa</h3>
      <p>Refazer o mapa</p>
    </button>

     <button class="rpg-menu-card" onclick="abrirSecao('sec-aventuras')">
      <div class="rpg-icon">ğŸ“</div>
      <h3>Aventuras</h3>
      <p>Aventuras</p>
    </button>

  </div>
</div>


<section id="pjSection" class="secao" style="display:none; padding:15px;">

  <!-- Top Bar -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <button class="btn btn-outline-secondary" onclick="voltarMenu()">â¬… Voltar</button>

    <div class="text-end">
      <h2 class="mb-0">Personagens Jogadores</h2>
      <small class="text-muted">Gerenciamento de PJs</small>
    </div>
  </div>

  <div class="row g-3">

    <!-- COLUNA ESQUERDA: Lista de PJs -->
    <div class="col-lg-7 col-12">

      <!-- Lista de PJs -->
      <div class="card p-3 mb-3 rpg-card">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h4 class="mb-0">ğŸ‘¥ Personagens</h4>
          <button class="btn btn-sm btn-success" onclick="abrirCriarPJ()">â• Criar PJ</button>
        </div>

        <div id="pjListaContainer" class="mt-2 p-2 card rpg-inner-card">
          <ul id="listaPJs" class="list-group list-group-flush"></ul>
        </div>
      </div>

    </div>

    <!-- COLUNA DIREITA: AÃ§Ãµes do Personagem -->
    <div class="col-lg-5 col-12">

      <!-- AÃ§Ãµes com PJ -->
      <div class="card p-3 mb-3 rpg-card">
        <h4 class="mb-2">âš”ï¸ AÃ§Ãµes do PJ</h4>

        <div class="d-flex flex-wrap gap-2 mb-3">
          <button class="btn btn-primary" onclick="abrirCriarPJ()">â• Novo PJ</button>
          <button class="btn btn-warning" onclick="exportarPJs()">ğŸ“¤ Exportar</button>
          <button class="btn btn-dark" onclick="importarPJs()">ğŸ“¥ Importar</button>
        </div>

        <div class="card p-3 rpg-inner-card">
          <small class="text-muted">
            Gerencie fichas, exporte para backup e adicione novos PJs Ã  campanha.
          </small>
        </div>
      </div>

      <!-- NavegaÃ§Ã£o -->
      <div class="card p-3 rpg-card">
        <h5 class="mb-2">ğŸ“š NavegaÃ§Ã£o</h5>
        <button class="btn btn-outline-secondary w-100" onclick="voltarMenu()">â¬… Voltar ao Menu</button>
      </div>

    </div>
  </div>

</section>

<div id="sec-aventuras" class="secao" style="display:none; padding: 15px;">

  <!-- Top Bar -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <button class="btn btn-outline-secondary" onclick="voltarMenu()">â¬… Voltar</button>

    <div class="text-end">
      <h2 id="aventuraTitulo" class="mb-0">Aventura</h2>
      <small class="text-muted">Gerenciamento de Aventuras</small>
    </div>
  </div>

  <div class="row g-3">

    <!-- COLUNA ESQUERDA â€“ Aventura + Cenas -->
    <div class="col-lg-7 col-12">

      <!-- Aventura / Resumo -->
      <div class="card p-3 mb-3 rpg-card">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h4 class="mb-0">ğŸ“˜ Aventura</h4>
          <button class="btn btn-sm btn-primary" onclick="detalharAventura()">Detalhar</button>
        </div>

        <div id="aventuraDetalhes" style="display:none;" class="mt-2 p-3 card rpg-inner-card"></div>
      </div>

      <!-- Cenas -->
      <div class="card p-3 mb-3 rpg-card">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h4 class="mb-0">ğŸ­ Cenas</h4>
        </div>

        <div class="mb-2 d-flex gap-2 flex-wrap">
          <button class="btn btn-success" onclick="gerarCena()">ğŸ² Gerar Cena</button>
          <button class="btn btn-danger" onclick="gerarCenaFinal()">ğŸ”¥ Cena Final</button>
        </div>

        <div id="resultadoCena" class="card p-3 rpg-inner-card mt-2"></div>
      </div>

    </div>

    <!-- COLUNA DIREITA â€“ AÃ§Ãµes Extras / NavegaÃ§Ã£o -->
    <div class="col-lg-5 col-12">

      <!-- AÃ§Ãµes Extras -->
      <div class="card p-3 mb-3 rpg-card">
        <h4 class="mb-2">âš”ï¸ AÃ§Ãµes Extras</h4>

        <div class="d-flex flex-wrap gap-2 mb-3">
          <button class="btn btn-warning" onclick="fazerBusca()">ğŸ§­ Busca</button>
          <button class="btn btn-danger" onclick="gerarComplicacao()">âš  ComplicaÃ§Ã£o</button>
          <button class="btn btn-info" onclick="gerarInspiracao()">ğŸ’¡ InspiraÃ§Ã£o</button>
        </div>

        <div id="resultadoExtras" class="card p-3 rpg-inner-card"></div>
      </div>

      <!-- Ver Aventuras -->
      <div class="card p-3 rpg-card">
        <h5 class="mb-2">ğŸ“š HistÃ³rico de Aventuras</h5>

        <button class="btn btn-primary w-100"
                onclick="abrirModalAventura(); atualizarListaAventuras();">
          ğŸ§­ Ver Aventuras
        </button>
      </div>

    </div>

  </div>

</div>

<!--    SECTION: PNJs          -->
<section id="pnjSection" class="secao" style="display:none; padding:15px;">

  <!-- Top Bar -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <button class="btn btn-outline-secondary" onclick="voltarMenu()">â¬… Voltar</button>

    <div class="text-end">
      <h2 class="mb-0">Personagens NÃ£o-Jogadores</h2>
      <small class="text-muted">Gerenciamento de PNJs</small>
    </div>
  </div>

  <div class="row g-3">

    <!-- COLUNA ESQUERDA â€“ Lista de PNJs -->
    <div class="col-lg-7 col-12">

      <div class="card p-3 mb-3 rpg-card">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h4 class="mb-0">ğŸ‘¤ PNJs</h4>
          <button class="btn btn-sm btn-primary" onclick="gerarPNJ_UI()">â• Criar PNJ</button>
        </div>

        <div class="mt-2 card p-2 rpg-inner-card">
          <div id="pnjLista" class="list-group list-group-flush"></div>
        </div>
      </div>

    </div>

    <!-- COLUNA DIREITA â€“ AÃ§Ãµes do sistema -->
    <div class="col-lg-5 col-12">

      <div class="card p-3 mb-3 rpg-card">
        <h4 class="mb-2">âš™ï¸ AÃ§Ãµes Extras</h4>

        <div class="d-flex flex-wrap gap-2 mb-3">
          <button class="btn btn-success" onclick="gerarPNJ_UI()">â• Novo PNJ</button>
          <button class="btn btn-warning" onclick="exportarPNJs()">ğŸ“¤ Exportar</button>
          <button class="btn btn-dark" onclick="importarPNJs()">ğŸ“¥ Importar</button>
        </div>

        <div class="card p-3 rpg-inner-card">
          <small class="text-muted">
            Gere PNJs rapidamente, mantenha registros organizados e exporte para backup da campanha.
          </small>
        </div>
      </div>

      <!-- NavegaÃ§Ã£o -->
      <div class="card p-3 rpg-card">
        <h5 class="mb-2">ğŸ“š NavegaÃ§Ã£o</h5>
        <button class="btn btn-outline-secondary w-100" onclick="voltarMenu()">â¬… Voltar ao Menu</button>
      </div>

    </div>
  </div>

</section>

<!-- ================= SEÃ‡ÃƒO ORÃCULO (Nova!) ================= -->
<div id="sec-oraculo" class="secao" style="display:none;">
  <h2>ğŸ”® OrÃ¡culo do Destino</h2>

  <p class="text-muted">Sistema completo baseado no Mythic.</p>

  <div class="card p-3 mb-3">
    <h5>âš–ï¸ Consulta ao OrÃ¡culo</h5>

    <label class="fw-bold">Probabilidade</label>
    <select id="oraculoProb" class="form-select mb-2">
        <option value="50_50">50/50</option>
        <option value="provavel">ProvÃ¡vel</option>
        <option value="muito_provavel">Muito ProvÃ¡vel</option>
        <option value="quase_certeza">Quase Certeza</option>
        <option value="certeza">Certeza</option>
        <option value="improvavel">ImprovÃ¡vel</option>
        <option value="muito_improvavel">Muito ImprovÃ¡vel</option>
        <option value="quase_impossivel">Quase ImpossÃ­vel</option>
        <option value="impossivel">ImpossÃ­vel</option>
    </select>

    <label class="fw-bold mt-2">Fator Caos</label>
    <div class="d-flex align-items-center gap-2">
      <input id="oraculoChaos" type="number" min="1" max="10" value="5" class="form-control w-auto">
      <small class="text-muted">(1â€“10)</small>
    </div>

    <button class="btn btn-primary mt-3" onclick="consultarDestino()">ğŸ” Consultar Destino</button>
    <button id="salvarOraculoBtn" class="btn btn-success mt-3" style="display:none;" onclick="salvarResultadoOraculo()">ğŸ’¾ Salvar no DiÃ¡rio</button>

    <div id="resultadoOraculo" class="mt-3" style="display:none;"></div>
  </div>

    <div class="card p-3 mt-4">
        <h5>ğŸ“š Gerar Descritores</h5>

        <label class="fw-bold">Tema:</label>
       <select id="temaDescritor" class="form-select mb-2">
            <option value="">Selecione...</option>
            <option value="acao">AÃ§Ã£o</option>
            <option value="descritor">DescriÃ§Ãµes</option>
            <option value="elemento">Elementos</option>
        </select>

        <label class="fw-bold mt-2">Tabela:</label>
        <select id="tabelaDescritor" class="form-select mb-2">
            <option value="">Escolha um tema primeiro</option>
        </select>

        <button class="btn btn-primary mt-2" onclick="gerarDescritor()">
            ğŸ² Gerar Descritor
        </button>

        <div id="resultadoDescritor" class="mt-3" style="display:none;"></div>
    </div>


  <button class="btn btn-outline-secondary mt-3" onclick="voltarMenu()">â¬… Voltar</button>
</div>

  <!-- ================= SEÃ‡ÃƒO TABELAS DO ORÃCULO ================= -->
<div id="sec-tabelas-oraculo" class="secao" style="display:none; padding: 15px;">

  <!-- Top Bar -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <button class="btn btn-outline-secondary" onclick="voltarMenu()">â¬… Voltar</button>

    <div class="text-end">
      <h2 class="mb-0">ğŸ“š Tabelas do OrÃ¡culo</h2>
      <small class="text-muted">Elementos narrativos usados pelo sistema</small>
    </div>
  </div>

  <div class="row g-3">

    <!-- COLUNA ESQUERDA -->
    <div class="col-lg-6 col-12">

      <!-- TRAMAS -->
      <div class="card p-3 mb-3 rpg-card">
        <h4 class="mb-2">ğŸ“˜ Tramas</h4>
        <p class="text-muted mb-2">Ganchos narrativos que afetam eventos da aventura.</p>

        <div class="input-group mb-2">
          <input id="novaTrama" type="text" class="form-control" placeholder="DescriÃ§Ã£o da trama">
          <button class="btn btn-success" onclick="adicionarTrama()">Adicionar</button>
        </div>

        <ul id="listaTramas" class="list-group rpg-inner-card"></ul>
      </div>

      <!-- PJs -->
      <div class="card p-3 mb-3 rpg-card">
        <h4 class="mb-2">ğŸ§ Personagens Jogadores</h4>
        <p class="text-muted mb-2">Nomes que o orÃ¡culo pode mencionar como aliados ou alvos.</p>

        <div class="input-group mb-2">
          <input id="novoPJ" type="text" class="form-control" placeholder="Nome do PJ">
          <button class="btn btn-success" onclick="adicionarPJ()">Adicionar</button>
        </div>

        <ul id="listaPJ" class="list-group rpg-inner-card"></ul>
      </div>

    </div>

    <!-- COLUNA DIREITA -->
    <div class="col-lg-6 col-12">

      <!-- PNJs -->
      <div class="card p-3 mb-3 rpg-card">
        <h4 class="mb-2">ğŸ§ PNJs</h4>
        <p class="text-muted mb-2">Figuras recorrentes usadas em complicaÃ§Ãµes e encontros.</p>

        <div class="input-group mb-2">
          <input id="novoPNJ" type="text" class="form-control" placeholder="Nome do PNJ">
          <button class="btn btn-success" onclick="adicionarPNJ()">Adicionar</button>
        </div>

        <ul id="listaPNJ" class="list-group rpg-inner-card"></ul>
      </div>

    </div>

  </div>
</div>

  <!-- ================= SEÃ‡ÃƒO DIÃRIO (Atualizada) ================= -->
<div id="sec-diario" class="secao" style="display:none;">
  <h2>ğŸ“˜ DiÃ¡rio da Campanha</h2>

  <!-- Cena Atual -->
  <div id="cenaAtualBox" class="alert alert-info" style="display:none;">
    <b>ğŸ¬ Cena Atual:</b> <span id="cenaAtualTexto"></span>
  </div>

  <button class="btn btn-primary w-100 mb-3" onclick="novaCena()">âœï¸ Criar Nova Cena</button>

  <div id="editorCena" class="card p-3 mb-3" style="display:none;">
    <label class="fw-bold">TÃ­tulo da Cena:</label>
    <input id="diarioTitulo" class="form-control mb-2">

    <label class="fw-bold">DescriÃ§Ã£o:</label>
    <textarea id="diarioTexto" class="form-control" rows="6"></textarea>

    <button class="btn btn-success mt-3" onclick="salvarCena()">ğŸ’¾ Salvar Cena</button>
    <button class="btn btn-outline-secondary mt-3" onclick="cancelarCena()">âŒ Cancelar</button>
  </div>

  <h4>ğŸ“œ Cenas Registradas</h4>
  <ul id="listaCenas" class="list-group mb-3"></ul>

  <button class="btn btn-danger btn-sm" onclick="limparCenas()">ğŸ—‘ï¸ Apagar Tudo</button>
  <button class="btn btn-outline-secondary mt-3" onclick="voltarMenu()">â¬… Voltar</button>
</div>


  <!-- ================= SEÃ‡ÃƒO MISSÃ•ES ================= -->
  <div id="missoes" class="secao" style="display:none;">
    <h2>ğŸ“œ MissÃµes</h2>

    <ul id="listaMissoesAtivas" class="list-group mb-3"></ul>

    <h4>âœ… MissÃµes ConcluÃ­das</h4>
    <ul id="listaMissoesConcluidas" class="list-group mb-3"></ul>
    
    <button class="btn btn-primary w-100 mb-3" onclick="gerarMissao()">ğŸ² Gerar MissÃ£o</button>

    <button class="btn btn-danger w-100 mb-3" onclick="limparHistoricoMissoes()">ğŸ—‘ï¸ Limpar HistÃ³rico</button>

    <button class="btn btn-secondary w-100" onclick="voltarMenu()">â¬…ï¸ Voltar</button>
  </div>

  <div id="sec-mapa" class="secao" style="display:none;">
    <div id="viewport">
      <div id="mapa"></div>
      <div id="token" class="token"></div>
    <div id="mapHUDTop">
        <div class="hud-pm">
          <div id="pmBarContainer">
            <div id="pmBar"></div>
          </div>
          <span id="pmText">PM: 6 / 6</span>
          <button id="btnDescansar" onclick="descansar()">â³ Descansar</button>
        </div>
    </div>
    <nav id="mapSideMenu">

      <button class="side-btn" onclick="abrirModalS('modalOraculo')" title="OrÃ¡culo">
        ğŸ”®
      </button>

      <button class="side-btn" onclick="abrirModalS('modalMissoes')" title="MissÃµes">
        ğŸ“œ
      </button>

      <button class="side-btn" onclick="abrirModalS('modalBoatos')" title="Boatos">
        ğŸ’¬
      </button>

      <button class="side-btn" onclick="abrirModalDetalhePjs()" title="Personagem">
        ğŸ‘¤
      </button>

      <button class="side-btn danger" onclick="voltarMenu()" title="Sair do Mapa">
        X
      </button>

  </nav>
  </div>
    
    <div id="terrainTooltip"
      style="
          position: fixed;
          padding: 6px 10px;
          background: rgba(0,0,0,0.75);
          color: white;
          font-size: 14px;
          border-radius: 6px;
          pointer-events: none;
          display: none;
          z-index: 9999;">
    </div>
  </div>


  <!-- ================= SEÃ‡ÃƒO ENCONTROS ================= -->
  <div id="sec-encontros" class="secao" style="display:none;">
    <h2>âš”ï¸ Encontros</h2>

    <label class="form-label fw-bold">Bioma</label>
    <select id="biomaSelect" class="form-select mb-3">
      <option value="planicie">PlanÃ­cie</option>
      <option value="floresta">Floresta</option>
      <option value="selva">Selva</option>
      <option value="deserto">Deserto</option>
      <option value="colina">Colina</option>
      <option value="montanha">Montanha</option>
      <option value="costeiro">Costeiro</option>
      <option value="marinho">Marinho</option>
      <option value="pantano">PÃ¢ntano</option>
      <option value="tundra">Tundra</option>
    </select>

    <button class="btn btn-primary w-100 mb-3" onclick="gerarEncontro()">Gerar Encontro</button>

    <div id="resultadoEncontro"></div>

    <div>
        <div id="encontrosAmbientais" class="card p-3 mb-3"></div><br>
    </div>

    

    <button class="btn btn-outline-warning" onclick="abrirModalDetalhePjs()">â¬… Ver Personagem</button>
    <button class="btn btn-outline-secondary" onclick="voltarMenu()">â¬… Voltar</button>
    
  </div>


  <!-- ================= SEÃ‡ÃƒO PONTOS DE INTERESSE ================= -->
<div id="sec-pi" class="secao" style="display:none;">
  <h2>ğŸŒ Pontos de Interesse</h2>

  <label class="form-label fw-bold">Tipo</label>
  <select id="tipoPiSelect" class="form-select mb-3">
    <option value="monstruoso">Monstruoso</option>
    <option value="geografico">GeogrÃ¡fico</option>
    <option value="npc">NPC</option>
    <option value="divino">Divino</option>
    <option value="magico">MÃ¡gico</option>
    <option value="militar">Militar</option>
  </select>

  <label class="form-label fw-bold">Bioma</label>
  <select id="biomaSelectPI" class="form-select mb-3">
    <option value="planicie">PlanÃ­cie</option>
    <option value="floresta">Floresta</option>
    <option value="selva">Selva</option>
    <option value="deserto">Deserto</option>
    <option value="colina">Colina</option>
    <option value="montanha">Montanha</option>
    <option value="costeiro">Costeiro</option>
    <option value="marinho">Marinho</option>
    <option value="pantano">PÃ¢ntano</option>
    <option value="tundra">Tundra</option>
  </select>

  <button class="btn btn-success w-100 mb-3" onclick="gerarPontoInteresse()">ğŸ² Gerar Ponto de Interesse</button>

  <div id="resultadoPI" class="card mt-3" style="display:none;">
    <div class="card-body" id="textoPI"></div>
  </div>

  <h4 class="mt-4">ğŸ“œ Pontos Descobertos</h4>
  <div id="listaPI"></div>

  <button class="btn btn-danger btn-sm mt-2" onclick="limparPI()">Limpar Todos</button>

  <button class="btn btn-outline-secondary mt-3" onclick="voltarMenu()">â¬… Voltar</button>
</div>
  

  <!-- ================= SEÃ‡ÃƒO BOATOS ================= -->
  <div id="sec-boatos" class="secao" style="display:none;">
    <h2>ğŸ’¬ Boatos</h2>

    <button class="btn btn-warning w-100 mb-3" onclick="gerarBoato()">Gerar Boato</button>

    <h4>Rumores Descobertos</h4>
    <ul id="listaRumores" class="list-group mb-3"></ul>
    <button class="btn btn-danger btn-sm" onclick="limparRumores()">Limpar</button>

    <button class="btn btn-outline-secondary mt-3" onclick="voltarMenu()">â¬… Voltar</button>
  </div>


  <!-- ================= SEÃ‡ÃƒO DUNGEON ================= -->
  <div id="sec-dungeon" class="secao" style="display:none; padding:12px;">
  <div class="dungeon-wrapper">

    <!-- Top bar / tÃ­tulo -->
    <div class="dungeon-topbar d-flex justify-content-between align-items-center mb-3">
      <div>
        <h2 id="dungeonTitulo" class="mb-0">ğŸ—ï¸ Dungeon</h2>
        <h6 id="dungeonSubtitulo" >Tipo: â€”</h6>
      </div>
      <div class="d-flex gap-2">
        <button class="btn btn-outline-secondary" onclick="voltarMapa()">â¬… Voltar</button>
        <button id="btnFinalizarDungeon" class="btn btn-success" onclick="finalizarDungeon()">Finalizar</button>
      </div>
    </div>

    <div class="row g-3">

      <!-- Left column: painel principal com salas -->
      <div class="col-lg-7 col-12">
        <div class="card p-3 mb-3 dungeon-card">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <div>
              <h5 class="mb-0" id="dungeonNomeDisplay">Nome: â€”</h5>
              <small id="dungeonTipoDisplay" class="text-muted">â€”</small>
            </div>

            <div class="d-flex gap-2 align-items-center">
              <button id="btnGerarSala" class="btn btn-primary" onclick="gerarSalaDungeon()">â• Gerar Sala</button>
              <button id="btnReiniciarContador" class="btn btn-outline-warning" onclick="resetarContadorSalas()">ğŸ” Reiniciar</button>
            </div>
          </div>

          <div id="dungeonControlsInfo" class="mb-2 text-muted">
            Use <strong>Gerar Sala</strong> para acrescentar uma nova sala. Salve a dungeon com Finalizar.
          </div>

          <div id="dungeonSalasList" class="list-group"></div>
        </div>

        <!-- Encontros / inimigos -->
        <div class="card p-3 dungeon-card">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="mb-0">Encontros</h5>
            <button class="btn btn-sm btn-primary" onclick="abrirAdicionarInimigo()">â• Inimigo</button>
          </div>

          <div id="listaInimigosAtivosUI"></div>
        </div>
      </div>

      <!-- Right column: mini-map + detalhes rÃ¡pidos -->
      <div class="col-lg-5 col-12">
        <div class="card p-3 mb-3 dungeon-card">
          <h5 class="mb-2">Mini-Mapa</h5>
          <div id="dungeonMiniMap" class="dungeon-minimap mb-2"></div>
          <small class="text-muted">Cada sala aparece como um nÃ³ (A, B, C...). Clique para focar.</small>
        </div>

        <div class="card p-3 dungeon-card">
          <h5 class="mb-2">Detalhes RÃ¡pidos</h5>
          <div><b>Salas:</b> <span id="dungeonContadorSalas">0</span></div>
          <div><b>Tipo:</b> <span id="dungeonTipoQuick">â€”</span></div>
          <div><b>Nome:</b> <span id="dungeonNomeQuick">â€”</span></div>

          <hr>
          <div class="d-flex gap-2 mt-2">
            <button class="btn btn-sm btn-outline-secondary" onclick="exportarDungeonJSON()">Exportar JSON</button>
            <button class="btn btn-sm btn-outline-danger" onclick="removerDungeonAtual()">Remover (do mapa)</button>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

  <!-- ================= SEÃ‡ÃƒO CAMPANHAS ================= -->
<div id="sec-campanhas" class="secao" style="display:none; padding: 15px;">

  <!-- Top Bar -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <button class="btn btn-outline-secondary" onclick="voltarMenu()">â¬… Voltar</button>

    <div class="text-end">
      <h2 class="mb-0">ğŸ“ Campanhas</h2>
      <small class="text-muted">Salvar, carregar e gerenciar progresso</small>
    </div>
  </div>

  <div class="row g-3">

    <!-- COLUNA ESQUERDA -->
    <div class="col-lg-7 col-12">

      <!-- Campanha Atual -->
      <div class="card p-3 mb-3 rpg-card">
        <h4 class="mb-2">ğŸ¯ Campanha Atual</h4>

        <div class="p-3 rpg-inner-card">
          <p class="mb-0">
            <b>Nome:</b> <span id="campanhaAtualNome" class="text-info"></span>
          </p>
        </div>
      </div>

      <!-- Criar Campanha -->
      <div class="card p-3 mb-3 rpg-card">
        <h4 class="mb-2">â• Criar Nova Campanha</h4>

        <div class="input-group">
          <input id="novaCampanhaNome" type="text" class="form-control" placeholder="Nome da nova campanha">
          <button class="btn btn-success" onclick="criarCampanha()">Criar</button>
        </div>
      </div>

    </div>

    <!-- COLUNA DIREITA -->
    <div class="col-lg-5 col-12">

      <!-- Campanhas Existentes -->
      <div class="card p-3 mb-3 rpg-card">
        <h4 class="mb-2">ğŸ“š Campanhas Existentes</h4>

        <ul id="listaCampanhas" class="list-group rpg-inner-card"></ul>
      </div>

    </div>

  </div>

</div>

<!-- ================= SEÃ‡ÃƒO CIDADES ================= -->
<div id="sec-cidade" class="secao" style="display:none;">
  <h2>ğŸ™ï¸ Cidades</h2>

  <button class="btn btn-primary w-100 mb-3" onclick="gerarCidade()">ğŸ² Gerar Cidade</button>

  <div id="resultadoCidade" class="card mt-3" style="display:none;">
    <div class="card-body" id="textoCidade"></div>
  </div>

  <h4 class="mt-4">ğŸ›ï¸ Cidades Descobertas</h4>
  <ul id="listaCidades" class="list-group mb-3"></ul>

  <button class="btn btn-danger btn-sm" onclick="limparCidades()">Limpar HistÃ³rico</button>

  <button class="btn btn-outline-secondary mt-3" onclick="voltarMenu()">â¬… Voltar</button>
</div>

</div>

<div id="modalDetalhesPNJ" class="modal-wrapper">
  
  <div class="modal-backdrop"></div>

  <div class="modal-card">
    
    <header class="modal-header">
      <h2>Detalhes do PNJ</h2>
      <button id="fecharModalPNJ" title="Fechar">âœ•</button>
    </header>

    <main class="modal-body" id="conteudoDetalhesPNJ">
      <!-- O conteÃºdo dinÃ¢mico que vocÃª jÃ¡ usa continuarÃ¡ carregando aqui -->
    </main>

    <footer class="modal-footer">
      <button id="fecharModalPNJBtn" class="btn">Fechar</button>
    </footer>

  </div>
</div>

<div id="modalEditarPNJ" class="modal-wrapper">
  
  <div class="modal-backdrop"></div>

  <div class="modal-card">

    <header class="modal-header">
      <h2>Editar PNJ</h2>
      <button id="fecharModalEditarPNJ" title="Fechar">âœ•</button>
    </header>

    <main class="modal-body" id="conteudoEditarPNJ">
      <!-- ConteÃºdo preenchido via JS permanece igual -->
    </main>

    <footer class="modal-footer">
      <button class="btn btn-success" onclick="salvarEdicaoPNJ()">Salvar</button>
    </footer>

  </div>

</div>


<div id="modalCriarPJ" class="modal-wrapper">

  <div class="modal-backdrop"></div>

  <div class="modal-card modal-xl" style="max-width:1100px;">

    <header class="modal-header">
      <h2 id="modalCriarPjTitulo">Criar PJ</h2>
      <button id="fecharModalCriarPJ" title="Fechar">âœ•</button>
    </header>

    <main class="modal-body">

      <form id="formCriarPJ">
        
        <input type="hidden" id="pjEditando">

        <h3>Ficha de Personagem</h3>

        <!-- ==================== LINHA 1 ==================== -->
        <div class="row">
          <div class="col">
            Nome:
            <input type="text" class="form-control" id="pjNome" required>
          </div>

          <div class="col">
            EspÃ©cie:
            <select id="pjEspecie" class="form-select" onchange="atualizarEspeciePVPE()">
              <option disabled selected>Escolha...</option>
              <option value="Ruma">Ruma (10 PV / 10 PE)</option>
              <option value="Pequenino">Pequenino (8 PV / 12 PE)</option>
              <option value="Duarvo">Duarvo (13 PV / 7 PE)</option>
              <option value="Kururuh">Kururuh (7 PV / 13 PE)</option>
              <option value="Elfo">Elfo (9 PV / 11 PE)</option>
              <option value="Silfo">Silfo (5 PV / 13 PE)</option>
              <option value="Akridiano">Akridiano (9 PV / 10 PE)</option>
              <option value="Diabrante">Diabrante (12 PV / 8 PE)</option>
              <option value="ArbÃ³reo">ArbÃ³reo (8 PV / 12 PE)</option>
              <option value="Felicato">Felicato (10 PV / 11 PE)</option>
              <option value="Javalique">Javalique (14 PV / 6 PE)</option>
              <option value="Komodo">Komodo (11 PV / 9 PE)</option>
            </select>
          </div>

          <div class="col">
            Origem:
            <select id="pjOrigem" class="form-select">
              <option disabled selected>Escolha...</option>
              <option>Urbano</option>
              <option>Florestal</option>
              <option>Campestre</option>
              <option>Pantanoso</option>
              <option>Costeiro</option>
              <option>DesÃ©rtico</option>
              <option>Pampeiro</option>
              <option>MontanhÃªs</option>
              <option>Glacial</option>
              <option>VulcÃ¢nico</option>
              <option>SubterrÃ¢neo</option>
              <option>NÃ´made</option>
            </select>
          </div>
        </div>

        <!-- ==================== LINHA 2 ==================== -->
        <div class="row mt-2">
          <div class="col">
            Classe:
            <select id="pjClasse" class="form-select" onchange="atualizarPVPEClasse()">
              <option disabled selected>Escolha...</option>
              <option>Arqueiro</option>
              <option>Bardo</option>
              <option>Berserker</option>
              <option>Cavaleiro</option>
              <option>Duelista</option>
              <option>Druida</option>
              <option>Mago</option>
              <option>LadrÃ£o</option>
              <option>Patrulheiro</option>
              <option>Necromante</option>
              <option>Protetor</option>
              <option>Soldado</option>
            </select>
          </div>

          <div class="col">
            Foco:
            <select id="pjFoco" class="form-select">
              <option disabled selected>Escolha...</option>
              <option>ForÃ§a</option>
              <option>SaÃºde</option>
              <option>Rapidez</option>
              <option>Sutileza</option>
              <option>ConcentraÃ§Ã£o</option>
              <option>ComunicaÃ§Ã£o</option>
            </select>
          </div>

          <div class="col">
            MotivaÃ§Ã£o:
            <input type="text" class="form-control" id="pjMotivacao">
          </div>
        </div>

        <hr>
        <h4>Pontos de Vida</h4>

        <div class="row">
          <div class="col">
            <label class="form-label">PV da EspÃ©cie</label>
            <input class="form-control" id="pjPVEspecie">
          </div>

          <div class="col">
            <label class="form-label">PV da Classe</label>
            <input class="form-control" id="pjPVClasse">
          </div>

          <div class="col">
            <label class="form-label">PV de Equipamentos</label>
            <input class="form-control" id="pjPVEquip">
          </div>

          <div class="col">
            <label class="form-label">PV MÃ¡ximo</label>
            <input class="form-control" id="pjPVMax">
          </div>

          <div class="col">
            <label class="form-label">PV Atual</label>
            <input class="form-control" id="pjPVAtual">
          </div>
        </div>

        <hr>
        <h4>Pontos de Energia</h4>

        <div class="row">
          <div class="col">
            <label class="form-label">PE da EspÃ©cie</label>
            <input class="form-control" id="pjPEEspecie">
          </div>

          <div class="col">
            <label class="form-label">PE da Classe</label>
            <input class="form-control" id="pjPEClasse">
          </div>

          <div class="col">
            <label class="form-label">PE de Equipamentos</label>
            <input class="form-control" id="pjPEEquip">
          </div>

          <div class="col">
            <label class="form-label">PE MÃ¡ximo</label>
            <input class="form-control" id="pjPEMax">
          </div>

          <div class="col">
            <label class="form-label">PE Atual</label>
            <input class="form-control" id="pjPEAtual">
          </div>
        </div>

        <hr>
        <h4>Armas em MÃ£os (atÃ© 3)</h4>
        <div id="pjArmas"></div>
        <button type="button" class="btn btn-secondary mt-2" onclick="abrirEscolhaArma()">Adicionar Arma</button>

        <hr>
        <h4>Escudo / Ferramenta</h4>
        <div id="pjEscudos"></div>
        <button type="button" class="btn btn-secondary mt-2" onclick="adicionarEscudo()">Adicionar Escudo</button>

        <hr>
        <h4>Equipamento Vestido</h4>
        <div id="pjEquipVestido"></div>
        <button type="button" class="btn btn-secondary mt-2" onclick="adicionarVestimenta()">Adicionar Vestimenta</button>

        <hr>
        <h4>Conhecimentos (atÃ© 8)</h4>

        <div class="d-flex gap-2">
          <select id="pjConhecimentoAdd" class="form-select">
            <option disabled selected>Escolha um conhecimento...</option>
            <option>Anatomia</option>
            <option>Alquimia</option>
            <option>Animais</option>
            <option>Crime</option>
            <option>DanÃ§a</option>
            <option>Estudos</option>
            <option>Forja</option>
            <option>Guerra</option>
            <option>HistÃ³ria</option>
            <option>Magia</option>
            <option>Mecanismos</option>
            <option>MÃºsica</option>
            <option>Nobreza</option>
            <option>Plantas</option>
            <option>SobrevivÃªncia</option>
          </select>

          <button type="button" class="btn btn-secondary" onclick="addConhecimento()">Adicionar</button>
        </div>

        <ul id="pjListaConhecimentos" class="list-group mt-2"></ul>

        <hr>
        <h4>Habilidades (atÃ© 12)</h4>

        <div class="d-flex gap-2">
          <button type="button" class="btn btn-primary" onclick="abrirHabClasse()">Habilidade da Classe</button>
          <button type="button" class="btn btn-secondary" onclick="abrirHabGeral()">Habilidade Geral</button>
        </div>

        <ul id="pjListaHabilidades" class="list-group mt-2"></ul>

        <hr>
        <h4>Mochila (atÃ© 10)</h4>

        <div id="listaMochila"></div>
        <button type="button" class="btn btn-primary mt-2" onclick="abrirModalAdicionarMochila()">Adicionar Item</button>

      </form>

      <input type="hidden" id="experiencia">
      <input type="hidden" id="riquesas">

    </main>

    <footer class="modal-footer">
      <button class="btn btn-secondary" id="cancelarCriarPJ">Cancelar</button>
      <button class="btn btn-primary" id="salvarPjBtn">Salvar</button>
    </footer>

  </div>

</div>

<!-- MODAL ADICIONAR/EDITAR MOCHILA -->
<div id="modalMochila" class="modal-wrapper">

  <div class="modal-backdrop"></div>

  <div class="modal-card">

    <header class="modal-header">
      <h2>Item da Mochila</h2>
      <button id="fecharModalMochila" title="Fechar">âœ•</button>
    </header>

    <main class="modal-body">

      <label class="form-label">Nome</label>
      <input id="mochilaNome" class="form-control">

      <label class="form-label mt-3">DescriÃ§Ã£o</label>
      <textarea id="mochilaDescricao" rows="3" class="form-control"></textarea>

    </main>

    <footer class="modal-footer">
      <button class="btn btn-secondary" id="btnCancelarMochila">Cancelar</button>
      <button class="btn btn-success" onclick="salvarItemMochila()">Salvar</button>
    </footer>

  </div>

</div>


<!-- Modal para escolher habilidade da classe -->
<div id="modalAddHabClasse" class="modal-wrapper" tabindex="-1">

  <div class="modal-backdrop"></div>

  <div class="modal-card">

    <header class="modal-header">
      <h2>Adicionar Habilidade da Classe</h2>
      <button id="fecharModalAddHabClasse" title="Fechar">âœ•</button>
    </header>

    <main class="modal-body">

      <label class="form-label">Selecione uma habilidade:</label>
      <select id="selectHabClasse" class="form-select"></select>

    </main>

    <footer class="modal-footer">
      <button class="btn btn-secondary" onclick="confirmarHabClasse()">Adicionar</button>
      <button class="btn btn-outline-secondary" id="fecharModalAddHabClasseBtn">Fechar</button>
    </footer>

  </div>

</div>

<div id="modalHabGeral" class="modal-wrapper">

  <div class="modal-backdrop"></div>

  <div class="modal-card">

    <header class="modal-header">
      <h2>Habilidades Gerais DisponÃ­veis</h2>
      <button id="fecharModalHabGeral" title="Fechar">âœ•</button>
    </header>

    <main class="modal-body">
      <select id="selectHabGeral" class="form-select"></select>
    </main>

    <footer class="modal-footer">
      <button class="btn btn-primary" onclick="confirmarHabGeral()">Adicionar</button>
    </footer>

  </div>

</div>

<div id="modalEscolherArma" class="modal-wrapper">

  <div class="modal-backdrop"></div>

  <div class="modal-card">

    <header class="modal-header">
      <h2>Escolher Arma</h2>
      <button id="fecharModalEscolherArma" title="Fechar">âœ•</button>
    </header>

    <main class="modal-body">

      <select id="listaArmas" class="form-select mb-3">
        <option value="">Selecione uma arma</option>
        <option value="MAGICA">âœ¨ Arma MÃ¡gica</option>
      </select>

      <div id="previewArma"></div>

    </main>

    <footer class="modal-footer">
      <button class="btn btn-secondary" id="btnCancelarEscolherArma">Cancelar</button>
      <button class="btn btn-primary" onclick="confirmarEscolhaArma()">Adicionar</button>
    </footer>

  </div>

</div>


<div id="modalSelecionarEscudo" class="modal-wrapper">

  <div class="modal-backdrop"></div>

  <div class="modal-card">

    <header class="modal-header">
      <h2>Escolher Escudo</h2>
      <button id="fecharModalSelecionarEscudo" title="Fechar">âœ•</button>
    </header>

    <main class="modal-body">
      <select id="selectEscudo" class="form-select">
        <!-- Preenchido via JS -->
      </select>
    </main>

    <footer class="modal-footer">
      <button class="btn btn-secondary" id="btnFecharModalSelecionarEscudo">Cancelar</button>
      <button class="btn btn-primary" onclick="confirmarEscudo()">Adicionar</button>
    </footer>

  </div>

</div>

<div id="modalSelecionarVestimenta" class="modal-wrapper">

  <div class="modal-backdrop"></div>

  <div class="modal-card">

    <header class="modal-header">
      <h2>Escolher Vestimenta</h2>
      <button id="fecharModalSelecionarVestimenta" title="Fechar">âœ•</button>
    </header>

    <main class="modal-body">
      <select id="selectVestimenta" class="form-select"></select>
    </main>

    <footer class="modal-footer">
      <button class="btn btn-secondary" id="btnFecharModalSelecionarVestimenta">Cancelar</button>
      <!-- Mesmo botÃ£o especial do original -->
      <button class="btn btn-warning" id="btnGerarVestimentaMagica" onclick="gerarVestimentaMagica()">
        âœ¨ Gerar Vestimenta MÃ¡gica
      </button>

      <button class="btn btn-primary" onclick="confirmarVestimenta()">Adicionar</button>
    </footer>

  </div>

</div>

<!-- Modal Selecionar Habilidade -->
<div id="modalHabilidadeClasse" class="modal-wrapper">

  <div class="modal-backdrop"></div>

  <div class="modal-card">

    <header class="modal-header">
      <h2>Selecionar Habilidade da Classe</h2>
      <button id="fecharModalHabilidadeClasse" title="Fechar">âœ•</button>
    </header>

    <main class="modal-body">
      <select id="selectHabilidadeClasse" class="form-select"></select>
    </main>

    <footer class="modal-footer">
      <button class="btn btn-secondary" id="btnCancelarHabClasse">Cancelar</button>
      <button class="btn btn-primary" onclick="confirmarHabilidadeClasse()">Adicionar</button>
    </footer>

  </div>

</div>


<div id="modalSelecionarMochila" class="modal-wrapper">

  <div class="modal-backdrop"></div>

  <div class="modal-card">

    <header class="modal-header">
      <h2>Adicionar Item Ã  Mochila</h2>
      <button id="fecharModalSelecionarMochila" title="Fechar">âœ•</button>
    </header>

    <main class="modal-body">

      <label class="form-label fw-bold">Selecione um item:</label>
      <select id="selectMochilaItem" class="form-select mb-3">
        <option value="">Selecione um item...</option>
      </select>

      <div id="previewMochilaItem"></div>

    </main>

    <footer class="modal-footer">
      <button class="btn btn-primary" onclick="confirmarItemMochila()">Adicionar</button>
    </footer>

  </div>

</div>

<div id="modalDetalhes" class="modal-wrapper">

  <div class="modal-backdrop"></div>

  <div class="modal-card modal-large">

    <header class="modal-header">
      <h2 id="modalDetalhesTitulo">Detalhes do PJ</h2>
      <button id="fecharModalDetalhes" title="Fechar">âœ•</button>
    </header>

    <main class="modal-body" id="modalDetalhesCorpo">
      <!-- conteÃºdo preenchido dinamicamente -->
    </main>

    <footer class="modal-footer">
      <button class="btn btn-secondary" id="btnFecharDetalhes" onclick="limparBackdrops()">Fechar</button>
    </footer>

  </div>

</div>

<div id="modalItemMochila" class="modal-wrapper">

  <div class="modal-backdrop"></div>

  <div class="modal-card">

    <header class="modal-header">
      <h2>Item da Mochila</h2>
      <button id="fecharModalItemMochila" title="Fechar">âœ•</button>
    </header>

    <main class="modal-body" id="conteudoItemMochila"></main>

    <footer class="modal-footer">
      <button class="btn btn-secondary" id="btnFecharModalItemMochila">Cancelar</button>
    </footer>

  </div>
</div>


<!-- Modal: Detalhes dos Especiais da Arma -->
<div id="modalDetalhesEspeciais" class="modal-wrapper">

  <div class="modal-backdrop"></div>

  <div class="modal-card modal-large">

    <header class="modal-header">
      <h2>Especiais da Arma</h2>
      <button id="fecharModalDetalhesEspeciais" title="Fechar">âœ•</button>
    </header>

    <main class="modal-body" id="modalDetalhesEspeciaisCorpo">
      <!-- preenchido via JS -->
    </main>

    <footer class="modal-footer">
      <button class="btn btn-secondary" id="btnFecharDetalhesEspeciais">Fechar</button>
    </footer>

  </div>

</div>

<div id="modalEspeciaisEscudo" class="modal-wrapper">

  <div class="modal-backdrop"></div>

  <div class="modal-card">

    <header class="modal-header">
      <h2>Especiais do Escudo</h2>
      <button id="fecharModalEspeciaisEscudo" title="Fechar">âœ•</button>
    </header>

    <main class="modal-body" id="conteudoEspeciaisEscudo"></main>

    <footer class="modal-footer">
      <button class="btn btn-secondary" id="btnFecharEspeciaisEscudo">Fechar</button>
    </footer>

  </div>

</div>

<div id="modalEspeciaisVestimenta" class="modal-wrapper">

  <div class="modal-backdrop"></div>

  <div class="modal-card">

    <header class="modal-header">
      <h2>Especiais da Vestimenta</h2>
      <button id="fecharModalEspeciaisVestimenta" title="Fechar">âœ•</button>
    </header>

    <main class="modal-body" id="conteudoEspeciaisVestimenta"></main>

    <footer class="modal-footer">
      <button class="btn btn-secondary" id="btnFecharEspeciaisVestimenta">Fechar</button>
    </footer>

  </div>

</div>


<div id="modalDetalhesHabilidades" class="modal-wrapper">

  <div class="modal-backdrop"></div>

  <div class="modal-card">

    <header class="modal-header">
      <h2>Detalhes das Habilidades</h2>
      <button id="fecharModalDetalhesHabilidades" title="Fechar">âœ•</button>
    </header>

    <main class="modal-body" id="conteudoDetalhesHabilidades">
    </main>

    <footer class="modal-footer">
      <button class="btn btn-secondary" id="btnFecharDetalhesHabilidades">Fechar</button>
    </footer>

  </div>
</div>

<div id="modalHabEspecie" class="modal-wrapper">

  <div class="modal-backdrop"></div>

  <div class="modal-card">

    <header class="modal-header">
      <h2>Habilidade da EspÃ©cie</h2>
      <button id="fecharModalHabEspecie" title="Fechar">âœ•</button>
    </header>

    <main class="modal-body" id="conteudoHabEspecie">
    </main>

    <footer class="modal-footer">
      <button class="btn btn-secondary" id="btnFecharModalHabEspecie">Fechar</button>
    </footer>

  </div>

</div>

<div id="modalDescansoLongo" class="modal-wrapper">

  <div class="modal-backdrop"></div>

  <div class="modal-card modal-small">

    <header class="modal-header">
      <h2>Descanso Longo</h2>
      <button id="fecharModalDescansoLongo" title="Fechar">âœ•</button>
    </header>

    <main class="modal-body">
      <p>VocÃª estÃ¡ em zona segura?</p>

      <button id="btnZonaSegura" class="btn btn-success w-100 mb-2">
        âœ” Zona Segura
      </button>

      <button id="btnZonaPerigosa" class="btn btn-danger w-100">
        âš  Zona Perigosa
      </button>
    </main>

    <footer class="modal-footer">
      <button class="btn btn-secondary" id="btnFecharModalDescansoLongo">Fechar</button>
    </footer>

  </div>

</div>

<div id="modalInimigo" class="modal-wrapper">

  <div class="modal-backdrop"></div>

  <div class="modal-card modal-large">

    <header class="modal-header">
      <h2>Ficha do Inimigo</h2>
      <button id="fecharModalInimigo" title="Fechar">âœ•</button>
    </header>

    <main class="modal-body" id="modalInimigoConteudo">
      <!-- conteÃºdo preenchido via JS -->
    </main>

    <footer class="modal-footer">
      <button class="btn btn-secondary" id="btnFecharModalInimigo">Fechar</button>
    </footer>

  </div>

</div>

<div id="modalAddInimigo" class="modal-wrapper">

  <div class="modal-backdrop"></div>

  <div class="modal-card">

    <header class="modal-header">
      <h2>Adicionar Inimigo</h2>
      <button id="fecharModalAddInimigo" title="Fechar">âœ•</button>
    </header>

    <main class="modal-body">

      <input type="text" id="buscaInimigo" class="form-control" 
             placeholder="Digite para buscarâ€¦" 
             oninput="filtrarInimigos()">

      <ul id="listaResultadosInimigos" class="list-group mt-2"></ul>

    </main>

    <footer class="modal-footer">
      <button class="btn btn-secondary" id="btnFecharModalAddInimigo">Fechar</button>
    </footer>


  </div>

</div>


<div id="modalSelecionarPJ" class="modal-wrapper">

  <div class="modal-backdrop"></div>

  <div class="modal-card">

    <header class="modal-header">
      <h2>Selecionar Personagem</h2>
      <button id="fecharModalSelecionarPJ" title="Fechar">âœ•</button>
    </header>

    <main class="modal-body">
      <label for="selectPJ" class="form-label">Escolha um personagem:</label>
      <select id="selectPJ" class="form-select"></select>

      <ul id="listaPjModal" class="list-group mt-2"></ul>
    </main>

    <footer class="modal-footer">
      <button class="btn btn-secondary" id="btnCancelarSelecionarPJ">Cancelar</button>
      <button class="btn btn-primary" onclick="confirmarSelecionarPJ()">OK</button>
    </footer>

  </div>

</div>

<div id="modalAventuras" class="modal-wrapper">

  <div class="modal-backdrop"></div>

  <div class="modal-card modal-large modal-scroll">

    <header class="modal-header">
      <h2>Aventuras Descobertas</h2>
      <button id="fecharModalAventuras" title="Fechar">âœ•</button>
    </header>

    <main class="modal-body" id="listaAventuras">
      <!-- conteÃºdo via JS -->
    </main>

    <footer class="modal-footer">
      <button class="btn btn-secondary" id="btnFecharAventuras">Fechar</button>
    </footer>

  </div>

</div>

<button id="btnVerCidade" style="display:none; position:fixed; bottom:22px; right:22px; z-index:99999;"
        class="btn btn-lg btn-primary">Ver Cidade</button>

<button id="btnVerPOI" style="display:none; position:fixed; bottom:22px; right:22px; z-index:99999;"
        class="btn btn-lg btn-primary">Ver POI</button>

<button id="btnEntrarDungeon" style="display:none; position:fixed; bottom:22px; right:22px; z-index:99999;"
        class="btn btn-lg btn-primary">Entrar na Dungeon</button>

<button id="btnEntrarAventura" style="display:none; position:fixed; bottom:22px; right:22px; z-index:99999;"
        class="btn btn-lg btn-primary">Entrar na Aventura</button>





<!-- Modal de cidade -->
<div id="modalCidade" class="modal-wrapper">
  <div class="modal-backdrop"></div>
  <div class="modal-card">
    <header class="modal-header">
      <h2 id="cidadeNome">Cidade</h2>
      <button id="fecharModalCidade" title="Fechar">âœ•</button>
    </header>

    <main class="modal-body">
      <div class="cidade-meta">
        <div><b>Tipo:</b> <span id="cidadeTipo"></span></div>
        <div><b>Apelido:</b>
          <input id="cidadeApelidoInput" type="text" maxlength="4" style="width:70px;margin-left:6px;">
          <button id="salvarApelidoCidade" class="btn btn-sm btn-outline-light">Salvar</button>
        </div>
      </div>

      <section>
        <h3>Estabelecimentos</h3>
        <div id="listaEstabelecimentos" class="estabs-grid"></div>
      </section>

      <section style="margin-top:12px;">
        <h3>Resumo</h3>
        <div id="cidadeResumo" style="white-space:pre-wrap;"></div>
      </section>
    </main>

    <footer class="modal-footer">
      <button id="fecharModalCidadeBtn" class="btn">Fechar</button>
    </footer>
  </div>
</div>

<div id="modalPOI" class="modal-wrapper">
  <div class="modal-backdrop"></div>
  <div class="modal-card">
    <header class="modal-header">
      <h2 id="poiTitulo">Ponto de Interesse</h2>
      <button id="fecharModalPOI" title="Fechar">âœ•</button>
    </header>

    <main class="modal-body">

      <div class="cidade-meta">
        <div><b>Tipo:</b> <span id="poiTipo"></span></div>
        <div><b>Bioma:</b> <span id="poiBioma"></span></div>
        <div><b>Apelido:</b>
          <input id="poiApelidoInput" type="text" maxlength="4" style="width:70px;margin-left:6px;">
          <button id="salvarApelidoPOI" class="btn btn-sm btn-outline-light">Salvar</button>
        </div>
      </div>

      <section style="margin-top:12px;">
        <h3>DescriÃ§Ã£o</h3>
        <div id="poiDescricao" style="white-space:pre-wrap;"></div>
      </section>

      <section style="margin-top:12px;">
        <h3>InteraÃ§Ãµes</h3>
        <b>Combate:</b>
        <div id="poiCombate" style="white-space:pre-wrap;"></div>

        <b style="margin-top:10px; display:block;">Paz:</b>
        <div id="poiPaz" style="white-space:pre-wrap;"></div>
      </section>

      <section style="margin-top:12px;">
        <h3>Ganchos</h3>
        <div id="poiGanchos" style="white-space:pre-wrap;"></div>
      </section>

      <section style="margin-top:12px;">
        <h3>VariaÃ§Ãµes</h3>
        <div id="poiVariacoes" style="white-space:pre-wrap;"></div>
      </section>

    </main>

    <footer class="modal-footer">
      <button id="btnFecharModalPOI" class="btn">Fechar</button>
    </footer>
  </div>
</div>

<div id="modalOraculo" class="modal-wrapper">

  <div class="modal-backdrop"></div>

  <div class="modal-card">

    <!-- Header -->
    <header class="modal-header">
      <h2>ğŸ”® OrÃ¡culo do Destino</h2>
      <button id="fecharModalOraculo" title="Fechar">âœ•</button>
    </header>

    <!-- Body -->
    <main class="modal-body">

      <p class="text-muted mb-3">Sistema completo baseado no Mythic.</p>

      <!-- ================= CONSULTA AO ORÃCULO ================= -->
      <div class="card p-3 mb-4 rpg-card">
        <h4 class="mb-3">âš–ï¸ Consulta ao OrÃ¡culo</h4>

        <label class="form-label fw-bold">Probabilidade</label>
        <select id="oraculoProbModal" class="form-select mb-3">
          <option value="50_50">50/50</option>
          <option value="provavel">ProvÃ¡vel</option>
          <option value="muito_provavel">Muito ProvÃ¡vel</option>
          <option value="quase_certeza">Quase Certeza</option>
          <option value="certeza">Certeza</option>
          <option value="improvavel">ImprovÃ¡vel</option>
          <option value="muito_improvavel">Muito ImprovÃ¡vel</option>
          <option value="quase_impossivel">Quase ImpossÃ­vel</option>
          <option value="impossivel">ImpossÃ­vel</option>
        </select>

        <label class="form-label fw-bold">Fator Caos</label>
        <div class="d-flex align-items-center gap-2 mb-2">
          <input id="oraculoChaosModal" type="number" min="1" max="10" value="5" class="form-control w-auto">
          <small class="text-muted">(1â€“10)</small>
        </div>

        <button class="btn btn-primary w-100 mt-2" onclick="consultarDestino()">ğŸ” Consultar Destino</button>

        <button id="salvarOraculoBtn" class="btn btn-success w-100 mt-2" style="display:none;"
                onclick="salvarResultadoOraculo()">ğŸ’¾ Salvar no DiÃ¡rio</button>

        <div id="resultadoOraculoModal" class="mt-3 rpg-inner-card p-3"></div>
      </div>

      <!-- ================= DESCRITORES ================= -->
      <div class="card p-3 rpg-card">
        <h4 class="mb-3">ğŸ“š Gerar Descritores</h4>

        <label class="form-label fw-bold">Tema</label>
        <select id="temaDescritorModal" class="form-select mb-3">
          <option value="">Selecione...</option>
          <option value="acao">AÃ§Ã£o</option>
          <option value="descritor">DescriÃ§Ãµes</option>
          <option value="elemento">Elementos</option>
        </select>

        <label class="form-label fw-bold">Tabela</label>
        <select id="tabelaDescritorModal" class="form-select mb-3">
          <option value="">Escolha um tema primeiro</option>
        </select>

        <button class="btn btn-primary w-100" onclick="gerarDescritor()">ğŸ² Gerar Descritor</button>

        <div id="resultadoDescritorModal" class="mt-3 rpg-inner-card p-3" style="display:none;"></div>
      </div>

    </main>

    <!-- Footer -->
    <footer class="modal-footer">
      <button class="btn btn-secondary" id="btnCancelarOraculo">Fechar</button>
    </footer>

  </div>
</div>

<div id="modalMissoes" class="modal-wrapper">

  <div class="modal-backdrop"></div>

  <div class="modal-card">

    <header class="modal-header">
      <h2>ğŸ“œ MissÃµes</h2>
      <button id="fecharModalMissoes" title="Fechar">âœ•</button>
    </header>

    <main class="modal-body">

      <!-- MISSÃ•ES ATIVAS -->
      <h4 class="mb-2">ğŸŸ¡ MissÃµes Ativas</h4>
      <ul id="listaMissoesAtivasModal" class="list-group mb-4"></ul>

      <!-- MISSÃ•ES CONCLUÃDAS -->
      <h4 class="mb-2">âœ… MissÃµes ConcluÃ­das</h4>
      <ul id="listaMissoesConcluidasModal" class="list-group mb-4"></ul>

      <!-- AÃ‡Ã•ES -->
      <button class="btn btn-primary w-100 mb-3" onclick="gerarMissao()">
        ğŸ² Gerar MissÃ£o
      </button>

      <button class="btn btn-danger w-100 mb-3" onclick="limparHistoricoMissoes()">
        ğŸ—‘ï¸ Limpar HistÃ³rico
      </button>

    </main>

    <footer class="modal-footer">
      <button class="btn btn-secondary" id="btnVoltarMissoes">Voltar</button>
    </footer>

  </div>

</div>

<div id="modalBoatos" class="modal-wrapper">

  <div class="modal-backdrop"></div>

  <div class="modal-card">

    <header class="modal-header">
      <h2>ğŸ’¬ Boatos</h2>
      <button id="fecharModalBoatos" title="Fechar">âœ•</button>
    </header>

    <main class="modal-body">

      <!-- BotÃ£o gerar boato -->
      <button class="btn btn-warning w-100 mb-3" onclick="gerarBoato()">
        Gerar Boato
      </button>

      <!-- Lista de rumores -->
      <h4 class="mb-2">Rumores Descobertos</h4>
      <ul id="listaRumoresModal" class="list-group mb-3"></ul>

      <button class="btn btn-danger btn-sm" onclick="limparRumores()">
        Limpar
      </button>

    </main>

    <footer class="modal-footer">
      <button class="btn btn-secondary" id="btnVoltarBoatos">Voltar</button>
    </footer>

  </div>

</div>

</body>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="tabelas.js"></script>
<script src="tabelasAventuras.js"></script>
<script src="tabelasGeracaoTerreno.js"></script>
<script src="tabelasCidades.js"></script>
<script src="functionsCampanha-prod.js"></script>
<script src="functionsFerramentas.js"></script>
<script src="functionsMapa.js"></script>
<!-- <script src="functionsCampanha-dev.js"></script> -->
<script src="functionsCenas.js"></script>
<script src="functionsCidades.js"></script>
<script src="functionsDungeon.js"></script>
<script src="functionsMissoes.js"></script>
<script src="functionsRumores.js"></script>
<script src="functionsEncontros.js"></script>
<script src="functionsPontosInteresse.js"></script>
<script src="functionsOraculo.js"></script>
<script src="functionsPNJ.js"></script>
<script src="functionsPJ.js"></script>

<script>


let mochilaEditIndex = null;
let mochilaTemp = [];    
// Rolagem
function d20() { return Math.floor(Math.random()*20)+1; }
function rolarD20() { return Math.floor(Math.random()*20)+1; }
function rolarD4() { return Math.floor(Math.random()*4)+1; }
function rolarD6() { return Math.floor(Math.random()*6)+1; }
function rolarD12() { return Math.floor(Math.random()*12)+1; }
function r(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
}

function rolar(lista) {
    return lista[Math.floor(Math.random() * lista.length)];
}



function voltarMenu() {
  // esconder seÃ§Ãµes
  document.querySelectorAll('.secao').forEach(sec => sec.style.display = 'none');
  // mostrar o menu corretamente
  const menu = document.getElementById('menu');
  menu.classList.remove('d-none');
  menu.classList.add('d-grid');
  atualizarBotaoCidadeAtual();
  atualizarBotaoPOIAtual();
  atualizarBotaoDungeonAtual();
  atualizarBotaoAventura();
}


function rolarD12() {
  return Math.floor(Math.random() * 12) + 1;
}

function rolar2d6() {
  return (Math.floor(Math.random()*6)+1) + "-" + (Math.floor(Math.random()*6)+1);
}


function rolar2d6Key() {
  const d1 = rolarD6();
  const d2 = rolarD6();
  return `${d1}-${d2}`;
}

function gerarTesouro() {
  const d = rolarD6();
  switch(d) {
    case 1:
    case 2:
      return 'Objeto Valioso';
    case 3:
      return 'Pedra Preciosa';
    case 4:
      return 'Item MÃ¡gico (Vestimenta MÃ¡gica)';
    case 5:
      return 'Item MÃ¡gico (Arma MÃ¡gica)';
    case 6:
      return 'Equipamento + Role novamente: ' + gerarTesouro();
  }
}

function rolarD10() {
  return Math.floor(Math.random() * 10) + 1;
}

// ----------------- Helpers -----------------

// =====================================
// ğŸ”® ORÃCULO DO DESTINO (usando destinoTabela)
// =====================================

// -------------------------
// ğŸ² Rola d100
// -------------------------
function d100() {
  return Math.floor(Math.random() * 100) + 1;
}

// ------------------------------
// ğŸ² Rola 2d10 (para Evento Caos)
// ------------------------------
function doisD10() {
  return {
    d1: Math.floor(Math.random() * 10) + 1,
    d2: Math.floor(Math.random() * 10) + 1
  };
}

function escapeHtml(unsafe) {
  return unsafe
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
}

// Remove tags HTML e mantÃ©m texto simples
function stripHtml(html) {
  const tmp = document.createElement("DIV");
  tmp.innerHTML = html;
  return tmp.textContent || tmp.innerText || "";
}

function salvarMissoes() { salvarCampanhas(); }
function salvarRumores() { salvarCampanhas(); }

</script>
</html>


